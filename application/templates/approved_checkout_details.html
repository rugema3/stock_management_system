<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approved Checkout details</title>

    <!-- Include necessary CSS -->
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='table_styles.css') }}">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

    <!-- Include jQuery (required by DataTables) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Include DataTables JavaScript -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

    <!-- Include jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- Include SheetJS for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.0/xlsx.full.min.js"></script>
</head>
<body class="selected-body">
    {% include 'sidebar.html' %}
    <h1>Checkout Summary</h1>
    <button class="export" onclick="exportToExcel()">Export to Excel</button>

    {% if approved_checkouts %}
    <table id="pending-items-table" class="display">
        <thead>
            <tr>
                <th>Checkout ID</th>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Initiated By</th>
                <th>Approver</th>
                <th>Approval Date</th>
            </tr>
        </thead>
        <tbody>
            {% for approved in approved_checkouts %}
            <tr>
                <td>{{ approved['checkout_id'] }}</td>
                <td>{{ approved['item_name'] }}</td>
                <td>{{ approved['quantity'] }}</td>
                <td>{{ user_names.get(approved['user_id'], 'Unknown') }}</td>
                <td>{{ approver_names.get(approved['approver_id'], 'Unknown') }}</td>
                <td>{{ approved['created_at'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No approved checkouts.</p>
    {% endif %}

    <!-- Initialize DataTable -->
    <script>
        $(document).ready(function() {
            $('#pending-items-table').DataTable();
        });

        // Export to PDF function
        function exportToPDF() {
            // Create new jsPDF instance
            const doc = new jsPDF();

            // Auto-table plugin for jsPDF
            doc.autoTable({ html: '#pending-items-table' });

            // Save the PDF with a filename
            doc.save('pending_items.pdf');
        }

        // Export to Excel function
        function exportToExcel() {
            var table = document.getElementById('pending-items-table');
            var wb = XLSX.utils.table_to_book(table, { sheet: 'Sheet1' });
            XLSX.writeFile(wb, 'checkout_summary.xlsx');
        }
    </script>
</body>
</html>